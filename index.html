<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>US States Map</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
            color: #333;
        }
        header {
            background-color: #4CAF50;
            color: white;
            padding: 20px;
            text-align: center;
        }
        #map {
            width: 100%;
            height: 100vh;
            position: relative;
        }
        .state {
            fill: #ccc;
            stroke: #333;
            stroke-width: 1;
            transition: fill 0.3s;
        }
        .state:hover {
            fill: #aaa;
            cursor: pointer;
        }
        .state.active {
            fill: #4CAF50;
        }
        .reset-button {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 10px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            z-index: 100;
            display: none;
        }
        .reset-button:hover {
            background-color: #3e8e41;
        }
        .state-info {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 4px;
            z-index: 100;
        }
    </style>
</head>
<body>
    <header>
        <h1>Interactive US States Map</h1>
    </header>
    <main>
        <div id="map">
            <button class="reset-button">Reset View</button>
            <div class="state-info"></div>
        </div>
    </main>
    <script>
        const width = window.innerWidth;
        const height = window.innerHeight - 100; // Account for header
        let activeState = null;

        // Set up the map projection
        const projection = d3.geoAlbersUsa()
            .translate([width / 2, height / 2])
            .scale([width]);

        // Set up the path generator
        const path = d3.geoPath().projection(projection);

        // Create an SVG element to contain the map
        const svg = d3.select("#map")
            .append("svg")
            .attr("width", width)
            .attr("height", height);

        // Create a group for the states
        const g = svg.append("g");

        // Get the state info div
        const stateInfo = d3.select(".state-info");

        // Set up zoom behavior
        const zoom = d3.zoom()
            .scaleExtent([1, 8])
            .on("zoom", (event) => {
                g.attr("transform", event.transform);
            });

        svg.call(zoom);

        // Function to reset the view
        function resetView() {
            svg.transition()
                .duration(750)
                .call(zoom.transform, d3.zoomIdentity);
            
            if (activeState) {
                d3.select(activeState).classed("active", false);
                activeState = null;
            }
            
            d3.select(".reset-button").style("display", "none");
            stateInfo.html("").style("display", "none");
        }

        // Add event listener to reset button
        d3.select(".reset-button").on("click", resetView);

        // Load the GeoJSON data for US states
        d3.json("https://raw.githubusercontent.com/PublicaMundi/MappingAPI/master/data/geojson/us-states.geojson")
            .then(data => {
                // Draw the states
                g.selectAll("path")
                    .data(data.features)
                    .join("path")
                    .attr("class", "state")
                    .attr("d", path)
                    .attr("id", d => `state-${d.properties.name.replace(/\s+/g, '-').toLowerCase()}`)
                    .on("mouseover", (event, d) => {
                        stateInfo.html(`<strong>${d.properties.name}</strong>`).style("display", "block");
                    })
                    .on("mouseout", () => {
                        if (!activeState) {
                            stateInfo.style("display", "none");
                        }
                    })
                    .on("click", function(event, d) {
                        event.stopPropagation();
                        
                        // Reset previous active state
                        if (activeState) {
                            d3.select(activeState).classed("active", false);
                        }
                        
                        // Set new active state
                        activeState = this;
                        d3.select(this).classed("active", true);
                        
                        // Show state info
                        stateInfo.html(`<strong>${d.properties.name}</strong>`).style("display", "block");
                        
                        // Show reset button
                        d3.select(".reset-button").style("display", "block");
                        
                        // Get the bounding box of the clicked state
                        const bounds = path.bounds(d);
                        const dx = bounds[1][0] - bounds[0][0];
                        const dy = bounds[1][1] - bounds[0][1];
                        const x = (bounds[0][0] + bounds[1][0]) / 2;
                        const y = (bounds[0][1] + bounds[1][1]) / 2;
                        
                        // Calculate the scale and translate parameters
                        const scale = Math.max(1, Math.min(8, 0.9 / Math.max(dx / width, dy / height)));
                        const translate = [width / 2 - scale * x, height / 2 - scale * y];
                        
                        // Apply the zoom transformation
                        svg.transition()
                            .duration(750)
                            .call(
                                zoom.transform,
                                d3.zoomIdentity
                                    .translate(translate[0], translate[1])
                                    .scale(scale)
                            );
                    });

                // Click on svg background to reset
                svg.on("click", function(event) {
                    if (event.target === this) {
                        resetView();
                    }
                });
            })
            .catch(error => {
                console.error("Error loading the GeoJSON:", error);
                d3.select("#map").html("<p>Error loading map data. Please try again later.</p>");
            });

        // Make map responsive
        window.addEventListener("resize", function() {
            const width = window.innerWidth;
            const height = window.innerHeight - 100;
            
            svg.attr("width", width)
               .attr("height", height);
            
            projection.translate([width / 2, height / 2])
                     .scale([width]);
            
            g.selectAll("path").attr("d", path);
        });
    </script>
</body>
</html>