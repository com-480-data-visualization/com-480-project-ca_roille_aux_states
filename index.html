<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>US States Map</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
            color: #333;
        }
        header {
            background-color: #4CAF50;
            color: white;
            padding: 20px;
            text-align: center;
        }
        #map {
            width: 100%;
            height: 100vh;
            position: relative;
        }
        .state {
            fill: #ccc;
            stroke: #333;
            stroke-width: 1;
            transition: fill 0.3s;
        }
        .state:hover {
            fill: #aaa;
            cursor: pointer;
        }
        .state.active {
            fill: #4CAF50;
        }
        .reset-button {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 10px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            z-index: 100;
            display: none;
        }
        .reset-button:hover {
            background-color: #3e8e41;
        }
        .state-info {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 4px;
            z-index: 100;
        }
    </style>
</head>
<body>
    <header>
        <h1>Interactive US States Map</h1>
    </header>
    <main>
        <div id="map">
            <button class="reset-button">Reset View</button>
            <div class="state-info"></div>
        </div>
    </main>
    <script>
        // Create a us-states.js file with this content and include it before this script
        // For now, we'll fetch from a more reliable CDN source
        const width = window.innerWidth;
        const height = window.innerHeight - 100; // Account for header
        let activeState = null;

        // Set up the map projection
        const projection = d3.geoAlbersUsa()
            .translate([width / 2, height / 2])
            .scale([width]);

        // Set up the path generator
        const path = d3.geoPath().projection(projection);

        // Create an SVG element to contain the map
        const svg = d3.select("#map")
            .append("svg")
            .attr("width", width)
            .attr("height", height);

        // Create a group for the states
        const g = svg.append("g");

        // Get the state info div
        const stateInfo = d3.select(".state-info");

        // Set up zoom behavior
        const zoom = d3.zoom()
            .scaleExtent([1, 8])
            .on("zoom", (event) => {
                g.attr("transform", event.transform);
            });

        svg.call(zoom);

        // Function to reset the view
        function resetView() {
            svg.transition()
                .duration(750)
                .call(zoom.transform, d3.zoomIdentity);
            
            if (activeState) {
                d3.select(activeState).classed("active", false);
                activeState = null;
            }
            
            d3.select(".reset-button").style("display", "none");
            stateInfo.html("").style("display", "none");
        }

        // Add event listener to reset button
        d3.select(".reset-button").on("click", resetView);

        // Try a different GeoJSON source
        d3.json("https://cdn.jsdelivr.net/npm/us-atlas@3/states-10m.json")
            .then(us => {
                // Convert TopoJSON to GeoJSON
                const states = topojson.feature(us, us.objects.states).features;
                
                // Draw the states
                g.selectAll("path")
                    .data(states)
                    .join("path")
                    .attr("class", "state")
                    .attr("d", path)
                    .attr("id", d => `state-${d.properties.name}`)
                    .on("mouseover", (event, d) => {
                        const stateName = d.properties.name || "State";
                        stateInfo.html(`<strong>${stateName}</strong>`).style("display", "block");
                    })
                    .on("mouseout", () => {
                        if (!activeState) {
                            stateInfo.style("display", "none");
                        }
                    })
                    .on("click", function(event, d) {
                        event.stopPropagation();
                        
                        // Reset previous active state
                        if (activeState) {
                            d3.select(activeState).classed("active", false);
                        }
                        
                        // Set new active state
                        activeState = this;
                        d3.select(this).classed("active", true);
                        
                        // Show state info
                        const stateName = d.properties.name || "State";
                        stateInfo.html(`<strong>${stateName}</strong>`).style("display", "block");
                        
                        // Show reset button
                        d3.select(".reset-button").style("display", "block");
                        
                        // Get the bounding box of the clicked state
                        const bounds = path.bounds(d);
                        const dx = bounds[1][0] - bounds[0][0];
                        const dy = bounds[1][1] - bounds[0][1];
                        const x = (bounds[0][0] + bounds[1][0]) / 2;
                        const y = (bounds[0][1] + bounds[1][1]) / 2;
                        
                        // Calculate the scale and translate parameters
                        const scale = Math.max(1, Math.min(8, 0.9 / Math.max(dx / width, dy / height)));
                        const translate = [width / 2 - scale * x, height / 2 - scale * y];
                        
                        // Apply the zoom transformation
                        svg.transition()
                            .duration(750)
                            .call(
                                zoom.transform,
                                d3.zoomIdentity
                                    .translate(translate[0], translate[1])
                                    .scale(scale)
                            );
                    });

                // Click on svg background to reset
                svg.on("click", function(event) {
                    if (event.target === this) {
                        resetView();
                    }
                });
            })
            .catch(error => {
                console.error("Error loading the GeoJSON:", error);
                
                // Fallback to using a simpler approach without external dependencies
                renderFallbackMap();
            });

        // Fallback function to render a simpler map if both sources fail
        function renderFallbackMap() {
            // Create a very basic map with rectangles representing states
            d3.select("#map").html("<p>Using simplified map due to data loading issues.</p>");
            
            const statesData = [
                {name: "Alabama", x: 650, y: 350, width: 50, height: 80},
                {name: "Alaska", x: 100, y: 450, width: 100, height: 80},
                {name: "Arizona", x: 200, y: 300, width: 60, height: 80},
                {name: "California", x: 100, y: 250, width: 60, height: 100},
                {name: "Colorado", x: 300, y: 250, width: 70, height: 60},
                {name: "Florida", x: 700, y: 400, width: 100, height: 50},
                {name: "New York", x: 700, y: 200, width: 70, height: 40},
                {name: "Texas", x: 400, y: 350, width: 100, height: 100}
                // Add more states as needed
            ];

            const simpleSvg = d3.select("#map")
                .append("svg")
                .attr("width", width)
                .attr("height", height);

            const simpleG = simpleSvg.append("g");

            simpleG.selectAll("rect")
                .data(statesData)
                .enter()
                .append("rect")
                .attr("x", d => d.x)
                .attr("y", d => d.y)
                .attr("width", d => d.width)
                .attr("height", d => d.height)
                .attr("fill", "#ccc")
                .attr("stroke", "#333")
                .attr("class", "state")
                .on("click", function(event, d) {
                    d3.select(this).attr("fill", "#4CAF50");
                    stateInfo.html(`<strong>${d.name}</strong>`).style("display", "block");
                });

            simpleG.selectAll("text")
                .data(statesData)
                .enter()
                .append("text")
                .attr("x", d => d.x + d.width/2)
                .attr("y", d => d.y + d.height/2)
                .attr("text-anchor", "middle")
                .attr("dominant-baseline", "middle")
                .attr("font-size", "10px")
                .text(d => d.name);
                
            // Add zoom functionality
            const simpleZoom = d3.zoom()
                .scaleExtent([1, 8])
                .on("zoom", (event) => {
                    simpleG.attr("transform", event.transform);
                });

            simpleSvg.call(simpleZoom);
        }

        // Make map responsive
        window.addEventListener("resize", function() {
            const width = window.innerWidth;
            const height = window.innerHeight - 100;
            
            svg.attr("width", width)
               .attr("height", height);
            
            projection.translate([width / 2, height / 2])
                     .scale([width]);
            
            g.selectAll("path").attr("d", path);
        });
    </script>
    <!-- Include TopoJSON for conversion -->
    <script src="https://unpkg.com/topojson-client@3"></script>
</body>
</html>